<?xml version="1.0" encoding="utf-8"?>
<s:Group xmlns:fx="http://ns.adobe.com/mxml/2009" 
		xmlns:s="library://ns.adobe.com/flex/spark" width="100%" height="100%" creationComplete="init(event)" removedFromStage="onRemoved(event)">
	<fx:Script>
		<![CDATA[
			import com.mightybits.hack.bubblepop.core.AppModel;
			import com.mightybits.hack.bubblepop.view.game.GameContainer;
			import com.mightybits.hack.bubblepop.view.game.GameView;
			
			import mx.events.FlexEvent;
			
			import starling.core.Starling;
			
			private var _game:GameView;
			
			
			protected function init(event:FlexEvent):void
			{
							
				if(!AppModel.starling)
				{
					AppModel.starling = new Starling(GameContainer, stage, AppModel.getViewPort());
				}	
				
				addEventListener(Event.ENTER_FRAME, onEnterFrame);
	
//				debug.addChild(new Stats());
			}
			
			protected function onRemoved(event:Event):void
			{
				if(AppModel.starling)
				{
					(AppModel.starling.root as GameContainer).removeGame();
					AppModel.starling.stop();
				}		
			}
			
			private function startGame():void
			{
				trace("START GAME", AppModel.starling.root);
				
				AppModel.starling.start();
				
				(AppModel.starling.root as GameContainer).createGame();
			}	
			
			protected function onEnterFrame(event:Event):void
			{
				trace("ENTER FRAME");
				if(AppModel.starling.root)
				{
					removeEventListener(Event.ENTER_FRAME, onEnterFrame);
					
					startGame();
				}
			}
			
		]]>
	</fx:Script>
	
	<fx:Declarations>
		<!-- Place non-visual elements (e.g., services, value objects) here -->
	</fx:Declarations>
	
	<!--<s:SpriteVisualElement id="gameView" width="100%" height="100%" />-->
	
	<!--<s:Label top="20" left="20" text="0000" fontSize="45" />-->
	
	<s:SpriteVisualElement id="debug" />
	
</s:Group>
